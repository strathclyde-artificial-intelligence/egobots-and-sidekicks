from os import listdir

print("setup,variant,egobot,locations,goals,framework_time,framework_plan_duration,single_agent_time,single_agent_duration","welderless_agent_time","welderless_agent_duration")

experimentfiles = [f for f in listdir() if "run_experiment" in f]
experimentfiles.remove("run_experiment_v1-5_e3-20_l3-15_pruned")
experimentfiles.remove("run_experiment_v5_e10_l4")
experimentstr = [ [] for _ in range(len(experimentfiles)) ]
for i,x in enumerate(experimentfiles):
    with open(x) as ff:
        experimentstr[i] = ff.readlines()

dirs = [f for f in listdir() if "results_v" in f]
for dir in dirs:

    orderchecker = [ [] for _ in range(len(experimentstr)) ]
    filefound = 0
    for i, list in enumerate(experimentstr):
        orderchecker[i] = [j for j,f in enumerate(list) if dir in f]
        orderchecker[i][:0] = [i]
        if len(orderchecker[i]) > 1:
            filefound = 1
    
    testcomplete = 1 # if the next loop bugs and doesn't set a value, the value of 1 is a better default than using the previous iteration's value
    if filefound == 0:
        testcomplete = 1 # returns a go-ahead if I can't find which run_experiment file created this result
    else:
        for pos in orderchecker: 
            if len(pos) > 1: # iterates through all the times this results folder can be found in run_experiment (should only be once)
                if pos[1] < len(experimentstr[pos[0]])-1: # checks that this results folder wasn't generated by the last line
                    nextexperiment = experimentstr[pos[0]][pos[1]+1]
                    if any(dir2 in nextexperiment for dir2 in dirs):
                        testcomplete = 1
                    else:
                        testcomplete = 0
                else:
                    testcomplete = 1

    if testcomplete == 1:
        print (dir, end=",")
        single_agent_file_list = [f for f in listdir(dir) if "Single" in f]
        if len(single_agent_file_list) > 0:
            single_agent_file = single_agent_file_list[0]
        else:
            single_agent_file = ''
        final_plan_list = [f for f in listdir(dir) if "Final" in f]
        if len(final_plan_list) > 0:
            final_plan = final_plan_list[0]
        else:
            final_plan = ''
        welderless_agent_file_list = [f for f in listdir(dir) if "Welderless" in f]
        if len(welderless_agent_file_list) > 0:
            welderless_agent_file = welderless_agent_file_list[0]
        else:
            welderless_agent_file = ''

        tokens = dir.split("_")
        variant = tokens[1][1:]
        egobots = tokens[2][1:]
        locations = tokens[3][1:]
        goals = int(locations)*4

        print(variant+","+egobots+","+locations+","+str(goals),end=",")

        # framework
        cost = "-"
        time = "-"
        if final_plan == '':
            print(time+","+cost,end=",")
        else:
            with open(dir+"/"+final_plan) as ff:
                lines = ff.readlines()
                state = 0 # reading sidekick plan
                plan_offset = 0.0
                for line in lines:
                    if "Egobot" in line: state = 1 # reading egobot plans

                    if state==0:
                        if "(" in line:
                            start = line.split(":")[0]
                            duration = line.split("[")[1][:-2]
                            if line.split(":")[0]=="0.000" and cost!="-":
                                plan_offset = float(cost)
                            c = plan_offset + float(start) + float(duration)
                            if cost=="-" or float(cost) < c:
                                cost = str(c)
                    else:
                        if "(" in line:
                            start = line.split(":")[0]
                            duration = line.split("[")[1][:-2]
                            c = float(start)+float(duration)
                            if cost=="-" or float(cost) < c:
                                cost = str(c)

                time = line
                print(time+","+cost,end=",")

        # single agent
        cost = "-"
        time = "-"
        if single_agent_file == '':
            time = 'no single agent plan'
            cost = 'no single agent plan'
            print(time+","+cost,end=",")
        else:
            with open(dir+"/"+single_agent_file) as saf:
                lines = saf.readlines()
                for line in lines:
                    if "; Plan found with metric " in line:
                        cost = line[len("; Plan found with metric "):].strip()
                    if "; Time " in line:
                        time = line[len("; Time "):].strip()
                print(time+","+cost,end=",")

        # single agent welderless
        cost = "-"
        time = "-"
        if welderless_agent_file == '':
            time = 'no welderless agent plan'
            cost = 'no welderless agent plan'
            print(time+","+cost,end="")
        else:
            with open(dir+"/"+welderless_agent_file) as saf:
                lines = saf.readlines()
                for line in lines:
                    if "; Cost: " in line:
                        cost = line[len("; Cost: "):].strip()
                    if "; Plan found with metric " in line:
                        cost = line[len("; Plan found with metric "):].strip()
                    if "; Time " in line:
                        time = line[len("; Time "):].strip()
                print(time+","+cost,end="")
        print("")